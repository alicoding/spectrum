<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>PageDown-Bootstrap Demo Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="stylesheet/less" href="/editor/demo.less">
    <script src="/editor/less/less-1.2.2.min.js"></script>
    <style>
        body {
            background-color: White;
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/editor/bootstrap/js/bootstrap-transition.js"></script>
    <script src="/editor/bootstrap/js/bootstrap-modal.js"></script>
    <script src="/editor/bootstrap/js/bootstrap-tooltip.js"></script>
    <script type="text/javascript" src="/js/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/js/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/js/Markdown.Editor.js"></script>

</head>
<body>

    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">PageDown-Bootstrap</a>
                <div class="nav-collapse">
                    <ul class="nav">
                        <li><a href="https://github.com/samwillis/pagedown-bootstrap">Project on GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        
      
        <div class="wmd-panel">
          <input type="text" value="{{title}}" placeholder="Text input" id="title">
        <div id="wmd-button-bar"></div>
        <textarea class="wmd-input" id="wmd-input">{{content}}</textarea>
        </div>
        <div id="wmd-preview" class="wmd-panel wmd-preview"></div>
    </div> 
                    <button id="post">post</button>

    <script type="text/javascript">
        (function () {
            var converter = new Markdown.Converter();
            var editor = new Markdown.Editor(converter);
            editor.run();
          
        })();
    </script>
    <script>
        $("#post").click(function (){

  var theContent = $('#wmd-input').val(),

   _title = $('#title').val(),
   
      _url = convertToSlug(_title.trim());
      if (!_title){
        return alert("Please enter the title");
      } 
      if(!theContent) {
        return alert("Please enter some content");
      }

      var editPost = '{{editParam}}';

      if(!editPost) {
        saveToServerAjaxCall('/new/post', {data:theContent,title:_title, url: _url}, function () {
        });
      } else {
        saveToServerAjaxCall('/edit/post', {data:theContent,title:_title,url:_url}, function () {
        });
      }

});

function saveToServerAjaxCall(url, data, callback) {

  $.ajax({
    type: 'POST',
    data: JSON.stringify(data),
    contentType: 'application/json',
    url: url,
    statusCode: {
      200: function (response) {

      },
      201: function (response) {

      },
      401: function (response) {

      },
      404: function (response) {

      }
   },
    success: function (data) {
      window.location.href = '/'+data.url;
    }
  });
}

function convertToSlug(Text)
{
    return Text
        .toLowerCase()
        .replace(/ /g,' ')
        .replace(/[^\w-]+/g,' ')
        ;
}
    </script>
</body>
</html>
